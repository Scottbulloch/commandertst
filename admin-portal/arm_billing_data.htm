<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation_Skin_SnowDocs" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../" data-mc-has-content-body="True" data-mc-toc-path="Admin Portal|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-conditions="General.NotForSPBuildHelp" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../Skins/Favicons/browserconfig.xml" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" /><title>Retrieve Azure Billing Data</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <meta charset="utf-8" />
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/Styles.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/fontAwesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/Stylesheets/roboto.font.css" rel="stylesheet" type="text/css" />
        <style>*
{
	box-sizing: border-box;
}

/* Create two columns that float next to each other */

.column
{
	
}

.column2
{
	
}

/* Clear floats after the columns */

.row:after
{
	content: "";
	display: table;
	clear: both;
}

</style>
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: linear-gradient(transparent, transparent);
}

.needs-pie
{
	behavior: url('../Resources/Scripts/PIE.htc');
}

</style>
        <style>/*&lt;meta /&gt;*/

.button.next-topic-button
{
	-pie-background: linear-gradient(transparent, transparent);
}

.needs-pie
{
	behavior: url('../Resources/Scripts/PIE.htc');
}

</style>
        <link href="../Resources/TableStyles/AccessAndAvailability.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" />
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-L05Y74KND5" async="async">
        </script>
        <script>/*<![CDATA[*/  window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

		gtag('config', 'G-L05Y74KND5');/*]]>*/</script>
        <script defer="defer" src="../Resources/Scripts/scroll_to_top_left_nav.js" type="text/javascript">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 900px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://docs.snowsoftware.io" title="Docs Portal Home" alt="Docs Portal Home"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="All Commander Docs" title="All Commander Docs" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Commander Docs</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div style="width: 100%; overflow: hidden;">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_SnowDocs_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" / " data-mc-breadcrumbs-count="3" data-mc-toc="True">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="column"> <div role="main" id="mc-main-content"><h1 id="RetrieveAzureBillingData" data-magellan-target="RetrieveAzureBillingData"><a name="aanchor320"></a><MadCap:concept term="Admin Portal" />Retrieve Azure Billing Data</h1><p>You can configure Commander to retrieve Azure billing data. Retrieving billing data improves the accuracy of <a href="chargeback-and-it-costing-reports.htm">costing reports</a> and <a href="cost-analytics.htm" class="MCXref xref">Cost Analytics</a>, because these reports include metered usage costs such as Storage and Network I/O. Billing data is retrieved immediately after you configure the billing data location. During a nightly scheduled task, the billing data is merged with the existing billing data in the VM billing records.</p><p>For more information on how Commander handles services it has not managed, see <a href="#discovered_arm" class="MCXref xref">Billing data for VMs not managed by Commander</a>.</p><p>Microsoft has deprecated support for Azure Enterprise Agreement Reporting APIs, which Commander use to retrieve billing data from Azure. Commander has introduced a new method for retrieving billing data for Azure Enterprise Agreement, Azure Plan, and Pay-As-You-Go accounts, that offers increased accuracy of Azure billing data. For more information, see <a href="#Retrieve" class="MCXref xref">Retrieve Azure billing data with .csv exports</a>.<p>For information on the&#160;legacy retrieval method, see <a href="#Retrieve2" class="MCXref xref">Retrieve Azure billing data (legacy method)</a>. The legacy method is only supported if you have upgraded to Commander 9.6 from a previous version. </p></p><p class="Note">Commander billing data are stored and queried in a universal date without time or time zone. For example, if you are retrieving or injecting billing data for November 30, 2021, Commander interprets this date without any time zone shift, regardless of where you are located. Cost information retrieved from this public cloud provider is split at midnight in the GMT time zone and then stored in Commander with a universal date without time or time zone.</p><h2 id="RetrieveAzurebillingdatawithcsvexports" data-magellan-target="RetrieveAzurebillingdatawithcsvexports"><a name="Retrieve"></a>Retrieve Azure billing data with .csv exports</h2><p>You can retrieve Azure billing data for Enterprise Agreement, Azure Plan, or Pay-As-You-Go accounts using .csv billing data exports. To use this  retrieval method, you must set up a number of prerequisites in Azure. </p><p>Switching to this retrieval method requires a billing reset on your Azure cloud accounts. This will erase historical billing data for your Azure subscriptions, however there are measures you can take to maintain historical records. Follow the steps for one of the options below.</p><ul><li><b>Historical billing data is not maintained</b></li><p>Follow these steps to switch to the new retrieval method without maintaining  historical billing records for your Azure subscriptions. </p><ol><li value="1">	Complete the Azure configurations for each of your Azure subscriptions. For more information, see <a href="#Create" class="MCXref xref">Create billing exports in Azure</a> and <a href="#Generate" class="MCXref xref">Generate blob SAS tokens and blob SAS URLs in Azure</a>.</li><li value="2">Upgrade to Commander 9.6.0.</li><li value="3">Configure Commander to use the new billing retrieval method. For more information, see <a href="#Configur" class="MCXref xref">Configure billing data retrieval  in Commander</a>.</li><li value="4">Reset Azure billing data for each of your Azure cloud accounts using the Commander REST API. For more information, see <a href="https://community.snowsoftware.com/s/article/Manual-Billing-Reset-through-Commander-API" class="LinkOut">Manual Billing Reset through Commander API</a>. </li></ol></ul><ul><li><b>Historical billing data is maintained</b></li><p>Follow these steps to maintain your historical billing records when switching to the new retrieval method.</p><p>It is recommended you wait five weeks between creating billing exports in your Azure subscriptions and configuring Commander to use the new retrieval method, since Azure can make retroactive changes to the exported billing files in the month after they have generated. For more information on how Commander accounts for these retroactive changes, see the note below in this section. </p><ol><li value="1">	Complete the Azure configurations for each of your Azure subscriptions. For more information, see <a href="#Create" class="MCXref xref">Create billing exports in Azure</a> and <a href="#Generate" class="MCXref xref">Generate blob SAS tokens and blob SAS URLs in Azure</a>.</li><li value="2">Upgrade to Commander 9.6.0.</li><li value="3">Wait five weeks for the exported .csv billing data  to accumulate in Azure, and then configure Commander to use the new billing retrieval method. For more information, see <a href="#Configur" class="MCXref xref">Configure billing data retrieval  in Commander</a>.</li><li value="4">Reset Azure billing data for each of your Azure cloud accounts using the Commander REST API, and enter a start date of four weeks prior to the current date. This will maintain Azure billing records that were retrieved prior to the creation of the .csv billing exports noted in step 1. For more information on performing billing resets, see <a href="https://community.snowsoftware.com/s/article/Manual-Billing-Reset-through-Commander-API" class="LinkOut">Manual Billing Reset through Commander API</a>. </li></ol></ul><p class="Note">Occasionally, Azure will add retroactive charges or modify existing charges in exported billing files, which results in discrepancies between the billing data that was ingested by Commander and the costs that are presently shown in the .csv files in Azure.
			To account for these discrepancies, for the first four days of each month, Commander inspects all .csv billing files from the previous calendar month. If billing changes are detected in any of the .csv files, the Commander billing data is updated accordingly.
		</p><h3><a name="Create"></a>Create billing exports in Azure</h3><p>This procedure applies to Azure's <a href="https://azure.microsoft.com/en-us/updates/improved-exports-experience/" class="LinkOut">Improved exports experience</a>. For more information, see <a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/tutorial-improved-exports#create-exports" class="LinkOut">Create exports</a>.
		</p><p>If you have already created billing exports for your Azure subscriptions, review the details to ensure the export settings are compatible with Commander's requirements. <![CDATA[	]]></p><p><p class="Note"> For information on the legacy process for creating billing exports in Azure, see <a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/tutorial-export-acm-data?tabs=azure-portal#create-a-daily-export" class="LinkOut">Create a daily export</a>. If using the legacy process, select <b>Actual</b> cost as the <b>Metric</b>, <b>Daily export of month-to-date costs</b> as the <b>Export type</b>, and turn on <b>File partitioning</b> to enable Commander to retrieve the billing data.</p></p><ol><li value="1">Sign in to the Azure portal.</li><li value="2">Go to <b>Cost Management +&#160;Billing</b> &gt; <b>Exports</b>. </li><li value="3">On the Exports page, select the billing scope you want to capture  data for. It is recommended that you configure a separate export for each  of your Azure subscriptions.</li><li value="4">Select <b>Create</b>.</li><li value="5">On the Basics tab, complete the fields in the <b>Add export</b> dialog:</li><ul><li><b>Type of data</b> — Select <b>Cost and usage details (actual)</b>.</li><li><b>Export name</b> — Enter a custom name for your export.</li><li><b>Dataset version</b>— Select <b>2021-01-01</b>.</li><li><b>Frequency</b> — Select <b>Daily export of month-to-date costs</b>.</li><li><b>Export description</b> — Optional:&#160;enter a description for the export.</li></ul><li value="6">Select <b>Add</b>.</li><li value="7">Go to the Destination tab.</li><li value="8">For <b>Storage type</b>, select <b>Azure blob storage</b>.</li><li value="9">For <b>Destination and storage</b>, select <b>Use existing</b> to export your billing data to an existing storage account, or <b>Create new</b> to export billing data to a new storage account.
			<p>If you select <b>Use existing</b>, complete the following fields:</p></li><ul><li><b>Subscription</b> — Choose the subscription  your .csv billing data files will be exported to.</li><li><p><b>Storage account</b> — Choose the storage account your .csv billing data files will be exported to.</p></li><li><p><b>Container</b> — Enter the name of the storage container your .csv files will be exported to.</p></li><li><p><b>Directory</b> — Enter the directory path for the container your .csv files will be exported to.</p></li></ul><p>If you select <b>Create new</b>, complete the following fields:</p><ul><li><b>Subscription</b> — Choose the subscription you want to deploy your new storage account in.</li><li><b>Resource group</b> — Choose the resource group you want your new storage account to be associated with.</li><li><b>Account name</b> — Enter a name for the storage account you are creating. This is the storage account your .csv billing data files will be exported to.</li><li><p><b>Location</b> — Choose the Azure region where your new storage account will be deployed.</p></li><li><p><b>Container</b> — Enter the name of the storage container your .csv files will be exported to.</p></li><li><p><b>Directory</b> — Enter the directory path for the container your .csv files will be exported to.</p></li></ul><li value="10">Enable <b>File partitioning</b>.<p class="caution">If File partitioning is disabled, billing retrieval will fail.</p></li><li value="11">Disable <b>Overwrite data</b>.<p class="caution">If Overwrite data is enabled, billing retrieval will fail.</p></li><li value="12">On the Review + create tab, review the details of your export and select <b>Create</b>. </li></ol><h3><a name="Generate"></a>Generate blob SAS tokens and blob SAS URLs in Azure</h3><p>Follow these steps for each billing export you create at the subscription level.</p><p>A shared access signature (SAS)&#160;is a URI&#160;that grants restricted access to storage container resources for a specified time range. For more information on generating SAS tokens in Azure, see <a href="https://learn.microsoft.com/en-us/azure/data-explorer/kusto/api/connection-strings/generate-sas-token" class="LinkOut">Generate a SAS token</a> in the Microsoft documentation. </p><ol><li value="1">In the Azure portal, go to the storage container that has the billing export you want Commander to retrieve. </li><li value="2">Select <b>Shared access tokens</b> on the sidebar menu.</li><li value="3">Complete the following settings:</li><ul><li>For <b>Signing method</b>, select <b>Account key</b>.</li><li> For <b>Signing key</b>, choose a key to associate with the SAS.</li><li>For <b>Stored access policy</b>, select <b>None</b>. Optionally, to create a stored access policy that manages the lifecyle of your SAS, see <a href="https://learn.microsoft.com/en-us/rest/api/storageservices/define-stored-access-policy" target="_blank" class="LinkOut">Define a stored access policy</a>.</li><li>For Permissions, select <b>Read</b> and <b>List</b> only.</li></ul><li value="4">Choose a start and expiry date and time for you SAS.
			<p class="caution">Once the SAS expires, Commander will no longer be able to retrieve exported billing data for your Azure subscription. To manage the lifecycle of your SAS, you can configure a stored access policy. For more information, see <a href="https://learn.microsoft.com/en-us/rest/api/storageservices/define-stored-access-policy" target="_blank" class="LinkOut">Define a stored access policy</a>. If your SAS&#160;expires and you do not have a stored access policy, you must manually re-generate a blob SAS token and blob SAS URL in Azure, and then update the values in Commander.</p></li><li value="5">For <b>Allowed protocals</b>, select <b>HTTPS</b>.</li><li value="6">Select <b>Generate SAS and connection string</b>.<p>The blob SAS token and blob SAS URL will generate and display below. Copy and save these values before leaving the page. </p></li> </ol><h3><a name="Configur"></a>Configure billing data retrieval  in Commander</h3><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/AccessAndAvailability.css');" class="TableStyle-AccessAndAvailability" cellspacing="0"><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Access:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Views &gt; Inventory &gt; Infrastructure or Applications</p></td></tr><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Available to:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Commander Roles of Superuser and Enterprise Admin; Administrator Access Rights</p></td></tr></table><ol><li value="1">From the Inventory tree, select an Azure cloud account.</li><li value="2">Go to <b>Actions</b> &gt; <b>Retrieve Billing Data</b>.</li><li value="3">In the Retrieve Azure Usage and Cost Data dialog, select <b>Enable  billing data retrieval</b>.</li><li value="4">Enter a blob SAS&#160;token, blob SAS URL, blob root directory, then click <b>OK</b>.
			</li></ol><p class="tip">The blob root directory is&#160;the navigational path to the .csv billing files, excluding the storage account and container name. To find this path in the Azure portal, go to <b>Cost Management +&#160;Billing</b> &gt;&#160;<b>Exports</b>, and select your billing export. From the Export details, copy the <b>Storage directory</b> value.</p><p>Switching to this  retrieval method from the legacy method  requires a billing data reset using REST API. For more information, see <a href="https://community.snowsoftware.com/s/article/Manual-Billing-Reset-through-Commander-API" class="LinkOut">Manual Billing Reset through Commander API</a>.</p><h2 id="RetrieveAzurebillingdatalegacymethod" data-magellan-target="RetrieveAzurebillingdatalegacymethod"><a name="Retrieve2"></a>Retrieve Azure billing data (legacy method)</h2><p>The legacy methods for billing retrieval are only supported for Commander versions prior to 9.6, or if you have upgraded to Commander 9.6 from a previous version. It is not available in new installations of version 9.6.
		</p><p>Using these legacy methods, Commander can retrieve a maximum of 60 days worth of billing data, including data from before the Azure account was added as a cloud account. Commander also retrieves Azure billing data for VMs that have never been managed by Commander. For example, if an Azure account was added as a cloud account 90 days ago, and you configure Commander to retrieve billing data today, Commander retrieves the last 60 days worth of billing data for all Azure VMs that have existed at any point over the last 60 days. As another example, if you add an Azure account as a cloud account today, and you configure Commander to retrieve billing data today, Commander retrieves the last 60 days worth of billing data for all Azure VMs that have existed at any point over the last 60 days, including VMs that were never managed by Commander.</p><h3><a name="Retrieve2"></a>Retrieve Azure billing data for Enterprise Agreement accounts (legacy)</h3><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/AccessAndAvailability.css');" class="TableStyle-AccessAndAvailability" cellspacing="0"><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Access:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Views &gt; Inventory &gt; Infrastructure or Applications</p></td></tr><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Available to:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Commander Roles of Superuser and Enterprise Admin; Administrator Access Rights</p></td></tr></table><ol><li value="1">From the Inventory tree, select an Azure cloud account.</li><li value="2">Select <b>Actions</b> &gt; <b>Retrieve Billing Data</b>.</li><li value="3">In the Retrieve Azure Usage and Cost Data dialog, select <b>Enable Azure Enterprise Agreement billing data retrieval (legacy)</b>.</li><li value="4">Enter the <b>Enrollment Number</b> that you received when you signed the Azure Enterprise Agreement contract.</li><li value="5">Enter the <b>Billing API Access Key</b>.</li><p>For instructions on how to generate the billing API access key, go to <a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/enterprise-api" class="LinkOut">Overview of the Azure Enterprise Reporting APIs</a>.</p><li value="6">Specify the <b>Currency</b> of the billing data being retrieved from Azure.</li><li value="7">Click <b>Test</b> to validate the enrollment number and check that the billing API access key is valid and hasn't expired.</li><li value="8">Click <b>OK</b>.
			<p>Sixty days of billing data is retrieved immediately, and a nightly task will update future records on a daily basis.</p></li></ol><p class="Note">After you have chosen an offer type for Azure Billing Retrieval, changing to a different offer type requires a billing data reset using REST API. For more information, see <a href="https://community.snowsoftware.com/s/article/Manual-Billing-Reset-through-Commander-API" class="LinkOut">Manual Billing Reset through Commander API</a>.</p><h3><a name="retrieving-non-ea-arm"></a>Retrieve Azure billing data for Pay-As-You-Go accounts (legacy)</h3><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/AccessAndAvailability.css');" class="TableStyle-AccessAndAvailability" cellspacing="0"><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Access:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Views &gt; Inventory &gt; Infrastructure or Applications</p></td></tr><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Available to:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Commander Roles of Superuser and Enterprise Admin; Administrator Access Rights</p></td></tr></table><p>If you set up a Pay-As-You-Go account package when you registered with Azure, use these steps to retrieve Azure billing data.
		</p><ol><li value="1">From the Inventory tree, select an Azure cloud account.</li><li value="2">Select <b>Actions</b> &gt; <b>Retrieve Billing Data</b>.</li><li value="3">In the Retrieve Azure Usage and Cost Data dialog, select <b>Enable Azure billing data retrieval (legacy)</b>.</li><li value="4">For Offer Type, select <b>Pay-As-You-Go</b>.</li><li value="5">Click <b>OK</b>.
			<p>Sixty days of billing data is retrieved immediately, and a nightly task will update future records.</p></li><p class="Note">After you have chosen an offer type for Azure Billing Retrieval, changing to a different offer type requires a billing data reset using REST API. For more information, see <a href="https://community.snowsoftware.com/s/article/Manual-Billing-Reset-through-Commander-API" class="LinkOut">Manual Billing Reset through Commander API</a>.</p></ol><h3><a name="retrieving-azure-plan"></a>Retrieve Azure billing data for Azure Plan accounts (legacy)</h3><p>Before you can retrieve Azure billing data for an account under the Azure Plan, you must set up a number of prerequisites.</p><h4>Prerequisites for retrieving Azure Plan billing data</h4><p>Follow these steps for each new subscription under the Azure Plan:</p><ol><li value="1">Using an automation tool, such as Azure Lighthouse, create a subscription for each of the customers you wish to onboard.</li><li value="2">For each of these subscriptions, create a dedicated service principle (an app) with an API key.</li><p>This app needs to have an IAM role on the subscription, with read permission on <code>Microsoft.Commerce</code>, specifically the "Read Rate Card" and "Read Usage Aggregates" permissions.</p><li value="3">Using the subscription ID and API key, add this subscription as a cloud account in Commander.</li></ol><h4>Retrieve billing data for Azure Plan</h4><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/AccessAndAvailability.css');" class="TableStyle-AccessAndAvailability" cellspacing="0"><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Access:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Views &gt; Inventory &gt; Infrastructure or Applications</p></td></tr><tr class="TableStyle-AccessAndAvailability-Body-Body1"><td class="TableStyle-AccessAndAvailability-BodyE-Column1-Body1"><p><b>Available to:</b></p></td><td class="TableStyle-AccessAndAvailability-BodyD-Column2-Body1"><p>Commander Roles of Superuser and Enterprise Admin; Administrator Access Rights</p></td></tr></table><ol><li value="1">From the Inventory tree, select an Azure cloud account.</li><li value="2">Select <b>Actions</b> &gt; <b>Retrieve Billing Data</b>.</li><li value="3">In the Retrieve Azure Usage and Cost Data dialog, select <b>Enable Azure billing data retrieval</b>.</li><li value="4">For Offer Type, select <b>Azure Plan</b>.</li><li value="5">Click <b>OK</b>.
			<p>Sixty days of billing data is retrieved immediately and a nightly task will update future records.</p></li></ol><p class="Note">After you've chosen an offer type for Azure Billing Retrieval, changing to a different offer type requires a billing data reset using REST API. For more information, see <a href="https://community.snowsoftware.com/s/article/Manual-Billing-Reset-through-Commander-API" class="LinkOut">Manual Billing Reset through Commander API</a>.</p><h2 id="DisabletheretrievalofAzurebillingdata" data-magellan-target="DisabletheretrievalofAzurebillingdata"><a name="disable-arm"></a>Disable the retrieval of Azure billing data</h2><ol><li value="1">From the Inventory tree, select an Azure cloud account.</li><li value="2">Select <b>Actions</b> &gt; <b>Retrieve Billing Data</b>.</li><li value="3">In the Retrieve Azure Usage and Cost Data dialog, select <b>Not Configured</b> and click <b>OK</b>.</li></ol><p>Commander will no longer retrieve billing data for this cloud account.</p><h2 id="Troubleshooting" data-magellan-target="Troubleshooting"><a name="troubleshoot"></a>Troubleshooting</h2><p>The following error message may show up on the Retrieve Azure Usage and Cost Data dialog after you enter your billing API access key: "Unable to access the Billing API service. The enrollment number might be incorrect, or the API access key is invalid or has expired." If your key has expired, you'll need to regenerate it. For instructions on how to generate the Billing API Access key, go to <a href="https://docs.microsoft.com/en-us/azure/billing/billing-enterprise-api" target="_blank">Overview of Reporting APIs for Enterprise Customers <span class="f_Icons_Inline"></span></a>.</p><h2 id="BillingdataforVMsnotmanagedbyCommander" data-magellan-target="BillingdataforVMsnotmanagedbyCommander"><a name="discovered_arm"></a>Billing data for VMs not managed by Commander</h2><p>Commander also retrieves Azure billing data for VMs that have never been managed by Commander, including charges for:</p><ul><li>VMs that exist only between Commander synchronizations with Azure, such as VMs spawned and torn down by an Auto Scaling Group</li><li>VMs that existed only before the Azure account was added as a Commander cloud account</li><li>VMs that existed only when the Commander service was down</li><li>existing VMs, including for periods before the Azure account was added as a cloud account</li></ul><p>When a VM not managed by Commander is discovered in the Azure billing report, the following occurs:</p><ul><li><a href="cost-models.htm" class="MCXref xref">Cost Models</a> are applied to VMs, based on their location in the Infrastructure or Applications tree</li><li>Ownership information is applied by the <a href="set-resource-ownership-with-policies.htm" class="hreflinks">Default Ownership policy</a>, or is inherited from the parent Resource Group.</li></ul><p class="Note">The <a href="set_default_attributes_policy.htm" class="hreflinks">Default Attributes policy</a> doesn't affect VMs discovered in the Azure billing report.</p><h2 id="BillingdataforallAzureservices" data-magellan-target="BillingdataforallAzureservices"><a name="unmanaged_arm"></a>Billing data for all Azure services</h2><p>When billing data retrieval is configured, Commander's cost analytics data accurately reflects the total cost you'll have to pay on your Azure bill and includes costs for services that Commander doesn't manage. Examples of such services include but are not limited to:</p><ul><li>data management</li><li>security center</li><li>business analytics</li><li>data services</li></ul><p>On your Azure bill, some of the costs for services may be divided into sub-categories. These sub-categories don't show up in Commander's cost analytics data. Only the total cost for a service is displayed.</p><p>If you have an Enterprise Agreement account, but configure the system for standard billing data retrieval, the resulting reports may show values that differ from your actual payments.</p><p>Ownership of each service will reflect the <a href="set-resource-ownership-with-policies.htm" class="hreflinks">ownership policy</a> that you set up on the cloud account, region, or resource group level.</p><p>Tax and Azure support plan fees are not included in the list of services because they are charged on a monthly basis.</p><h2 id="AzureBillingTags" data-magellan-target="AzureBillingTags">Azure Billing Tags</h2><p>Billing Tags allow you to group and filter your expenses in more detail. You can use these tags to filter expenses in Cost Analytics, the Service Portal Cost Dashboard, and the Cloud Billing Report. Billing Tag information is part of your Azure account billing data and is automatically imported during billing data retrieval. For information on using Billing Tags in formulas for Additional Line Items, see <a href="cost_models.htm#additional_line_items" class="MCXref xref">Additional Line Items page</a>.</p><ul class="NoteMultiple"><li>Before upgrade to 8.1.0, filtering Cost Analytics and the Service Portal Cost Dashboard by Custom Attributes affected the Recommendations. After upgrade, filtering by Billing Tags won't affect the Recommendations.</li><li>Billing Tags and SKUs will only be retrieved from Version 8.1.0 and forward, unless billing records are reset. Create a case through the <a href="https://community.snowsoftware.com/s/support-hub" class="LinkOut">Snow Support Portal</a> if you want to perform this activity.</li></ul><hr width="100%" size="0" align="center" /><p class="legal-disclaimer" data-mc-autonum="Snow Software does not own the third party trademarks, software, products, or tools (collectively, the “Third Party Products”) referenced herein. Third Party Product updates, including user interface updates, may not be reflected in this content."><span class="autonumber"><span>Snow Software does not own the third party trademarks, software, products, or tools (collectively, the “Third Party Products”) referenced herein. Third Party Product updates, including user interface updates, may not be reflected in this content.</span></span>&#160;</p></div><div><div style="border-top-color: rgb(245, 245, 245); border-top-style: none; border-top-width: 1px; margin-top: 22px;"><br /><div class="buttons popup-container clearfix topicToolbarProxy _Skins_ToolbarSnowDocsBottomLeft mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic;"><div class="button-group-container-left"><button class="button needs-pie previous-topic-button" title="Previous Topic" disabled="true"><div><div role="img" class="button-icon-wrapper" aria-label="Previous Topic"><div class="button-icon"> </div></div></div></button></div></div><div class="buttons popup-container clearfix topicToolbarProxy _Skins_ToolbarSnowDocsBottomRight mc-component nocontent" style="mc-topic-toolbar-items: NextTopic;"><div class="button-group-container-left"><button class="button needs-pie next-topic-button" title="Next Topic" disabled="true"><div><div role="img" class="button-icon-wrapper" aria-label="Next Topic"><div class="button-icon"> </div></div></div></button></div></div><p>&#160;</p><div style="border-top-color: rgb(245, 245, 245); border-top-style: solid; border-top-width: 1px; margin-top: 22px;"><p>&#160;</p></div><p class="footer-logo">Snow Commander <span class="mc-variable General.VersionShort variable">9.7</span> documentation</p><p class="footer-logo"><img src="../Resources/Images/copyright-regular-8.svg" /> <span class="mc-variable General.Year variable">2024</span> <span class="mc-variable General.CompanyName variable">Flexera</span>&#160;&#160;&#160;Last modified: <span class="mc-variable General.ISOShortDate variable">2024-10-16</span>&#160;&#160;&#160;<span style="color: #FFF;" class="mc-variable System.ShortTime variable">9:31 AM</span></p><p class="footer-logo"><a class="footer-links-herschel" href="https://www.flexera.com/legal/privacy-policy" target="_blank" data-mc-conditions="General.ForWebOnly">Privacy policy</a>&#160;&#160;&#160;<a class="footer-links-herschel" href="https://www.flexera.com/legal" target="_blank">Terms and conditions</a>&#160;&#160;&#160;<a class="footer-links-herschel" href="mailto:docsportal-feedback@snowsoftware.com" target="_blank">Feedback</a></p><p><span class="hide-when-mobile"><span style="color: #ffffff;" class="mc-variable System.ShortDate variable">10/16/2024</span>&#160;&#160;<span style="color: #ffffff;" class="mc-variable System.ShortTime variable">9:31 AM</span>&#160;&#160;<span style="color: #ffffff;" class="mc-variable General.Version variable">9.7.1</span></span></p></div></div></div>
                                        <div class="column2">
                                            <div data-sticky-container="" id="DURN9edKrkWh1itM7rpYww">
                                                <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="DURN9edKrkWh1itM7rpYww:top" data-bottom-anchor="contentBody:bottom" data-scroll-container=".body-container" data-sticky-on="only screen and (min-width: 901px)" data-scroll-container-on="only screen and (min-width: 901px)">
                                                    <ul data-magellan="" data-animation-duration="250" data-active-class="selected" data-scroll-container=".body-container" data-scroll-container-on="only screen and (min-width: 901px)" class="nocontent menu _Skins_SideMenuWithInThisTopicColumn mc-component">
                                                        <li class="tree-node"><a href="#RetrieveAzureBillingData">Retrieve Azure Billing Data</a>
                                                            <ul>
                                                                <li class="tree-node"><a href="#RetrieveAzurebillingdatawithcsvexports">Retrieve Azure billing data with .csv exports</a>
                                                                </li>
                                                                <li class="tree-node"><a href="#RetrieveAzurebillingdatalegacymethod">Retrieve Azure billing data (legacy method)</a>
                                                                </li>
                                                                <li class="tree-node"><a href="#DisabletheretrievalofAzurebillingdata">Disable the retrieval of Azure billing data</a>
                                                                </li>
                                                                <li class="tree-node"><a href="#Troubleshooting">Troubleshooting</a>
                                                                </li>
                                                                <li class="tree-node"><a href="#BillingdataforVMsnotmanagedbyCommander">Billing data for VMs not managed by Commander</a>
                                                                </li>
                                                                <li class="tree-node"><a href="#BillingdataforallAzureservices">Billing data for all Azure services</a>
                                                                </li>
                                                                <li class="tree-node"><a href="#AzureBillingTags">Azure Billing Tags</a>
                                                                </li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="scrollup" style="margin-bottom: 0px; margin-left: 17px;"><a id="scrollup" style="cursor: pointer;">Scroll</a>
                                    </p>
                                    <p>
                                        <!-- This referenced snippet allows an alt text statement to be included for the logo/go-home button on the top of each page -->
                                        <script>/*<![CDATA[*/$(document).ready(function(){
   $('a.logo').attr({
     alt: 'Snow Docs Home',
     title: 'Snow Docs Home'
   });
});/*]]>*/</script>
                                    </p>
                                    <script type="text/javascript">/*<![CDATA[*/if ($(".sticky-menu > ul").children("ul").length == 0){
        $(".sticky-menu > ul").css("visibility", "hidden");
    }/*]]>*/</script>
                                    <script defer="defer" src="../Resources/Scripts/scroll_to_top_left_nav.js" type="text/javascript">
                                    </script>
                                    <script type="text/javascript">/*<![CDATA[*/$("#home-link").prependTo("div.MCBreadcrumbsBox_SnowDocs_0");/*]]>*/</script>
                                    <script type="text/javascript" src="../Resources/Scripts/fa_ext_link.js">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>